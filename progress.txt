# Gear Grinder - Development Progress Log

---

## Reddit Community Feedback Fixes - January 2026

### Status: COMPLETE

### Fixes Implemented

- [x] **US-1: Achievement stat points persist through prestige**
  - Added `achievementStatPoints` tracking
  - Prestige now re-grants achievement stat points
  - Players no longer lose ~125+ stat points on prestige

- [x] **US-2: Tier filter includes prestige tiers (Astral, Cosmic, Primordial)**
  - Changed `TIERS.slice(0, 7)` to `TIERS`
  - All 10 tiers now visible in filter dropdown

- [x] **US-3: Item locking feature**
  - Added `locked` property to items
  - Lock/unlock toggle in UI (ðŸ”’/ðŸ”“)
  - Locked items protected from Salvage All
  - Locked items protected from auto-salvage
  - Desktop: Middle-click to toggle lock
  - Mobile: Dedicated lock button

- [x] **US-4: Luck stat description clarity**
  - Changed "+0.5% gold" to "+0.5% silver find"
  - Currency is silver, not gold

- [x] **US-5: Remove ore/leather references**
  - Updated "Starting Bonus" skill description
  - Removed unused resources from prestige logic

- [x] **US-6: Large font overflow fix**
  - Added CSS overflow handling for xlarge text
  - Removed min-width constraints causing overflow

- [x] **US-7: Effects filter consistency**
  - Extended tier filter to all tiers
  - Improved auto-salvage logic
  - Boss items now protected from auto-salvage

### Balance Feedback Documented

- AGI meta (speed farming optimization)
- Boss items vs random items (effects comparison)
- Enhancement stone bottleneck
- Currency exchange suggestion

### Files Modified

- `game/data/initialState.js`
- `game/data/achievements.js`
- `game/data/stats.js`
- `game/data/skills.js`
- `game/managers/GameManager.js`
- `game/context/GameContext.jsx`
- `game/ui/InventoryView.jsx`
- `game/systems/CombatSystem.js`
- `styles/game.css`
- `improvements.md`

---

# Mobile Portrait Redesign - Progress Log

Started: 2026-01-20

## Status: IN PROGRESS - Phase 4 COMPLETE, Phase 6 Next

---

## Completed Steps

- [x] Created implementation plan in FEATURES.md
- [x] Defined 7 phases with acceptance criteria
- [x] Mapped out new file structure
- [x] Phase 1.1: Created useIsMobile hook (game/hooks/useIsMobile.js)
- [x] Phase 1.2: Created MobileGameLayout shell (game/ui/MobileGameLayout.jsx)
- [x] Phase 1.3: Updated GameLayout to route mobile vs desktop
- [x] Phase 2.1: Created MobileCombatView - **FIXED: Now uses real GameRenderer with sprites!**
- [x] Phase 3.1: Created MobileTabBar component (game/ui/MobileTabBar.jsx)
- [x] Phase 5.1: Created MobileBottomBar component (game/ui/MobileBottomBar.jsx)
- [x] Phase 4.1: Updated InventoryView for mobile (5-col grid, long-press salvage, full item cards)
- [x] Phase 4.2: Updated StatsView for mobile (vertical layout, touch-friendly buttons)
- [x] Phase 4.3: Updated EnhancementView for mobile (vertical stack layout)
- [x] Phase 4.4: Updated SkillsView for mobile (touch-friendly unlock buttons)
- [x] Phase 4.5: Updated ZoneView with touch feedback

---

## Current Step

- [ ] Phase 6: Polish (safe areas, touch feedback, performance, cross-browser)
- [ ] Test mobile layout on actual device/emulator

---

## Phase Progress

### Phase 1: Setup & Detection
- [x] 1.1 useIsMobile hook
- [x] 1.2 MobileGameLayout shell
- [x] 1.3 Layout routing

### Phase 2: Mobile Combat View
- [x] 2.1 MobileCombatView component - Uses REAL GameRenderer!
- [x] 2.2 Combat state connection (via GameRenderer)

### Phase 3: Mobile Tab Navigation
- [x] 3.1 MobileTabBar component
- [x] 3.2 Tab state management

### Phase 4: Mobile Tab Content - COMPLETE
- [x] 4.1 Mobile Inventory (5-col grid, touch support, full item cards with comparison)
- [x] 4.2 Mobile Stats (vertical layout, touch-friendly buttons, 2-col combat stats)
- [x] 4.3 Mobile Enhancement (vertical layout)
- [x] 4.4 Mobile Skills (touch-friendly unlock buttons)
- [x] 4.5 Mobile Zone/Map (touch feedback)
- [x] 4.6 Mobile More Menu (built into MobileGameLayout)

### Phase 5: Mobile Bottom Bar
- [x] 5.1 MobileBottomBar component

### Phase 6: Polish
- [x] 6.1 Safe area handling (viewport-fit=cover, CSS utilities)
- [x] 6.2 Touch feedback (touch-action: manipulation, active:scale-95)
- [ ] 6.3 Performance
- [ ] 6.4 Cross-browser testing

### Phase 7: Capacitor (Future)
- [ ] 7.1 Add Capacitor
- [ ] 7.2 Configure app
- [ ] 7.3 Build & test

---

## Key Fixes Made

**FIX 1**: Initially made mistake of replacing PIXI.js GameRenderer with emoji
placeholders. This has been FIXED - MobileCombatView now uses the real GameRenderer
component with actual sprites, monsters, backgrounds, and animations.

**FIX 2 - Sprites not visible**: The GameRenderer was using fixed pixel positions that
put sprites off-screen on small mobile canvases:
- groundY = canvasHeight - 200 â†’ negative on 176px canvas!
- playerX = centerX - 200 â†’ off-screen on narrow screens!

Fixed by making positions scale relative to canvas size:
- groundY = max(canvasHeight * 0.85, canvasHeight - 70)
- charSpacing = min(200, canvasWidth * 0.25)
- Added scaleFactor = min(1, canvasHeight / 400) for all elements

**FIX 3 - React Hook Error #310**: Caused by conditional return before all hooks.
Fixed by splitting GameLayout into router component and DesktopGameLayout component.

The canvas is displayed in a 176px height container with:
- Zone header above (name + currency)
- Controls below (Rest/Fight toggle + speed controls)

---

## Files Created

1. game/hooks/useIsMobile.js - Mobile detection hook
2. game/ui/MobileGameLayout.jsx - Main mobile layout container
3. game/ui/MobileCombatView.jsx - Wraps real GameRenderer for mobile
4. game/ui/MobileTabBar.jsx - Touch-friendly tab navigation
5. game/ui/MobileBottomBar.jsx - XP/level footer

## Files Modified

1. game/ui/GameLayout.jsx - Added mobile routing, fixed React hooks error
2. game/ui/InventoryView.jsx - Mobile responsive grid + touch, full item cards with stats/comparison
3. game/ui/EnhancementView.jsx - Mobile vertical layout
4. game/ui/ZoneView.jsx - Touch feedback
5. game/renderer/GameRenderer.jsx - Mobile scaling for sprites, HP bars, shadows, floating text
6. game/ui/StatsView.jsx - Mobile vertical layout, touch-friendly buttons, 2-col combat stats
7. game/ui/SkillsView.jsx - Mobile touch-friendly unlock buttons

---

## Notes

- Mobile layout renders for screen width < 768px in portrait orientation
- Combat view uses REAL GameRenderer with all sprites and animations
- Inventory shows full item cards with stats, set bonuses, and comparison to equipped
- Stats view shows attributes in vertical list, combat stats in 2-column grid
- Skills view has larger touch-friendly unlock buttons
- Enhancement view stacks vertically on mobile
- More menu provides access to Prestige/Achievements/Settings

